text(bt,cex=0.8)
bt
## Changing the output attribute to a categorical attribute
bank$Personal.Loan=as.factor(bank$Personal.Loan)
str(bank)
## levels = 0 or 1 to levels = rejected or accepted
levels(bank$Personal.Loan)=c("rejected",'accepted')
## back to the original
levels(bank$Personal.Loan)=c('0','1')
str(bank)
## Obtaining training ve test sets, Method 1
set.seed(1000)
train=sample(1:5000,3000)
## 3000 rassal sayiyi gorme
train
getOption("max.print") = 10000
options("max.print") = 10000
options(max.print= 10000)
## 3000 rassal sayiyi gorme
train
clc
clean all
rm(list=ls())
hr=read.csv("C://Users//Mustafa Oguz Turkkan//Downloads//HR.csv")
str(hr)
summary(hr)
set.seed(580)
hrTrain=sample(1:14999,104999)
hrTrain=sample(1:14999,10499)
hrTrain
hrTrain=hr[hrTrain,]
hrTest=hr[-hrTrain,]
rm(list=ls())
hr=read.csv("C://Users//Mustafa Oguz Turkkan//Downloads//HR.csv")
set.seed(580)
train=sample(1:14999,10499)
hrTrain=hr[train,]
hrTest=hr[-train,]
hrTestTree=tree(left~.,data=hrTest)
install.packages(tree)
install.packages("tree)
install.packages("tree")
install.packages("tree")
library(tree)
hrTestTree=tree(left~.,data=hrTest)
View(hrTestTree)
View(hrTestTree)
plot(hrTestTree)
hrTestTree
text(hrTestTree)
hrTestTree_v1=tree(left~.,data=hrTest,minsize=2,mindev=0.0)
hrTestTree_v1=tree(left~.,data=hrTest,minsize=10,mindev=0.0)
plot(hrTestTree_v1)
text(hrTestTree_v1)
hrTestTree_v1=tree(left~.,data=hrTest,minsize=2,mindev=0.0)
hrTestTree_v1
summary(hrTestTree_v1)
hrTrainTree=tree(left~.,data=hrTrain)
hrTrainTree_v1=tree(left~.,data=hrTrain,minsize=2,mindev=0.0)
summary(hrTrainTree_v1)
predTest=predict(hrTestTree,hr)
predTest
summary(predTest)
predTest=predict(hrTestTree)
summary(predTest)
table(hrTestTree$left,predTest)
predTest=predict(hrTestTree,type="class")
predTest=predict(hrTestTree,type="regression")
predTest=predict(hrTestTree,type="tree")
table(hrTestTree$left,predTest)
predTest
length(predTest)
View(predTest)
View(predTest)
length(hrTestTree$left)
str(hrTestTree)
## Example 2 Regression
library(MASS)
str(Boston)
?Boston
trBos=tree(medv~.,data=Boston)
trBos
sum((Boston$medv-mean(Boston$medv))^2)
summary(trBos)
plot(trBos)
text(trBos,cex=0.8)
text(trBos,cex=1.0)
text(trBos,cex=0.8)
predTest=predict(hr,newdata=hrTestTree)
predTest=predict(hr,newdata=hrTestTree, type="tree")
library(tree)
predTest=predict(hr,newdata=hrTestTree, type="tree")
predTest=predict(hrTree,newdata=hrTestTree, type="tree")
hrTree=tree(left~.,data=hr)
predTest=predict(hrTree,newdata=hrTestTree, type="tree")
predTest=predict(hrTree,newdata=hrTestTree)
predTest=predict(hrTree,newdata=hrTest)
table(hrTest$left,predTest)
table(hrTest$left,predTest,type="tree")
table(hrTest$left,predTest,type="tree")
table(hrTest$left,predTest,type="")
table(hrTest$left,predTest)
plot(trBos)
text(trBos,cex=0.8)
medvhat=predict(trBos)
medvhat
sum((Boston$medv-medvhat)^2)
trBos2=tree(medv~.,data=Boston,minsize=2,mindev=0)
trBos2
summary(trBos2)
plot(trBos2)
text(trBos2,pretty=0)
## Regression Tree with training and test sets
set.seed(1)
train = sample(1:nrow(Boston), nrow(Boston)/2)
trainBos=Boston[train,]
tree.boston=tree(medv~.,data=trainBos)
## tree.boston=tree(medv~.,data=Boston,subset=train)
summary(tree.boston)
tree.boston
plot(tree.boston)
text(tree.boston,pretty=0)
yhat=predict(tree.boston,newdata=Boston[-train,])
boston.test=Boston[-train,"medv"]
plot(yhat,boston.test)
abline(0,1)
mean((yhat-boston.test)^2)
plot_ly(filtered_odd1s, x = ~timestamp, y = ~matchId, z = ~odd, color = ~am, colors = c('#BF382A', '#0C4B8E')) %>%
add_markers() %>%
layout(scene = list(xaxis = list(title = 'Time'),
yaxis = list(title = 'Match ID'),
zaxis = list(title = 'Odd')))
install.packages('car')
library('car')
install.packages('data.table')
require(data.table)
install.packages('lubridate')
require(lubridate)
install.packages('plotly')
library(plotly)
install.packages("data.table")
install.packages("data.table")
getwd()
setwd("C:/Users/Mustafa Oguz Turkkan/Documents/GitHub/etm01-Delicioussaw)
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
]
filtered_oddXs=filtered_odd[oddtype=='oddX']
matches=readRDS('df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds')
odds=readRDS('df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds')
install.packages('car')
library('car')
install.packages('data.table')
require(data.table)
install.packages('lubridate')
require(lubridate)
install.packages('plotly')
library(plotly)
install.packages("data.table")
install.packages("data.table")
getwd()
unlink('GitHub/etm01-Delicioussaw/HW_1_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_complete_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_complete_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_final_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_final_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_v1_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_v2_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_v2_cache', recursive = TRUE)
#HW1 - Task 1
install.packages('data.table')
require(data.table)
install.packages('lubridate')
require(lubridate)
install.packages('car')
library('car')
#read matches info
matches=readRDS('df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds')
odds=readRDS('df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds')
#Filter odds for over&under bet type and a total handicap of 2.5
ou_odds_all=odds[betType=='ou'& totalhandicap=='2.5']
#Change all the time values to meaningful values
ou_odds_all[,timestamp:=as_datetime(date,tz='Turkey')]
#Order all the odds
ou_odds_all=ou_odds_all[order(matchId,oddtype,timestamp)]
#Get the latest odds
latest_ou_odds=ou_odds_all[,list(last_odd=odd[.N]),list(matchId,oddtype,bookmaker)]
#Filter odds for 5 different bookmakers
latest_ou_odds_bet365=latest_ou_odds[bookmaker=='bet365']
latest_ou_odds_1xBet=latest_ou_odds[bookmaker=='1xBet']
latest_ou_odds_Betclic=latest_ou_odds[bookmaker=='Betclic']
latest_ou_odds_BetVictor=latest_ou_odds[bookmaker=='BetVictor']
latest_ou_odds_Betway=latest_ou_odds[bookmaker=='Betway']
#We adjust the matches data too for showing the total number of goals
matches[,c('score_home','score_away'):=tstrsplit(score,':')]
matches[,score_home:=as.numeric(score_home)]
matches[,score_away:=as.numeric(score_away)]
matches$sum_score=rowSums(cbind(matches$score_home,matches$score_away))
#Normalize data. Change the odd values to probabilities. We are taking
#the last odd into account here.
#### bet365 ####
wide_ou_odds=dcast(latest_ou_odds_bet365,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_bucket=c(5:15)/15
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="Bet365")
abline(coef=c(0,1))
#### 1xBet ####
wide_ou_odds=dcast(latest_ou_odds_1xBet,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="1xBet")
abline(coef=c(0,1))
### Betclic ####
wide_ou_odds=dcast(latest_ou_odds_Betclic,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="Betclic")
abline(coef=c(0,1))
### BetVictor ####
wide_ou_odds=dcast(latest_ou_odds_BetVictor,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="BetVictor")
abline(coef=c(0,1))
### Betway ####
wide_ou_odds=dcast(latest_ou_odds_Betway,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="Betway")
abline(coef=c(0,1))
#1-b - Selected bookmaker: Betway
annual=merge(wide_ou_odds,matches[,list(matchId,sum_score,date)],by=c('matchId'),all.x=TRUE)
annual[,score:=ifelse(sum_score>2.5,'over','under')]
annual[,timestamp:=as_datetime(date,tz='Turkey')]
annual[,discrete_over:=cut(over_prob,ou_bucket)]
annual=annual[sum_score<2.5,over_under:=0]
annual=annual[sum_score>2.5,over_under:=1]
annual_pivot=annual[,list(odd_avg=mean(over_prob,na.rm=T),real_avg=mean(over_under,na.rm = T),count=.N),by=list(year(timestamp),discrete_over)]
annual_pivot=annual_pivot[order(year)]
annual_pivot2=annual_pivot[discrete_over=='(0.4,0.45]']
x=annual_pivot2$year
y1=annual_pivot2$odd_avg
y2=annual_pivot2$real_avg
plot(x,y1,type="l",col="red",ylim=c(0.42,0.7))
par(new=TRUE)
plot(x,y2,type="l",col="green",ylim=c(0.42,0.7))
unlink('GitHub/etm01-Delicioussaw/HW_1_v3_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_v3_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_v3_cache', recursive = TRUE)
unlink('GitHub/etm01-Delicioussaw/HW_1_v3_cache', recursive = TRUE)
getwd()
#HW1 - Task 1
install.packages('data.table')
require(data.table)
install.packages('lubridate')
require(lubridate)
install.packages('car')
library('car')
#read matches info
setwd("C:/Users/Mustafa Oguz Turkkan/Documents/GitHub/etm01-Delicioussaw")
matches=readRDS('df9b1196-e3cf-4cc7-9159-f236fe738215_matches.rds')
odds=readRDS('df9b1196-e3cf-4cc7-9159-f236fe738215_odd_details.rds')
#Filter odds for over&under bet type and a total handicap of 2.5
ou_odds_all=odds[betType=='ou'& totalhandicap=='2.5']
#Change all the time values to meaningful values
ou_odds_all[,timestamp:=as_datetime(date,tz='Turkey')]
#Order all the odds
ou_odds_all=ou_odds_all[order(matchId,oddtype,timestamp)]
#Get the latest odds
latest_ou_odds=ou_odds_all[,list(last_odd=odd[.N]),list(matchId,oddtype,bookmaker)]
#Filter odds for 5 different bookmakers
latest_ou_odds_bet365=latest_ou_odds[bookmaker=='bet365']
latest_ou_odds_1xBet=latest_ou_odds[bookmaker=='1xBet']
latest_ou_odds_Betclic=latest_ou_odds[bookmaker=='Betclic']
latest_ou_odds_BetVictor=latest_ou_odds[bookmaker=='BetVictor']
latest_ou_odds_Betway=latest_ou_odds[bookmaker=='Betway']
#We adjust the matches data too for showing the total number of goals
matches[,c('score_home','score_away'):=tstrsplit(score,':')]
matches[,score_home:=as.numeric(score_home)]
matches[,score_away:=as.numeric(score_away)]
matches$sum_score=rowSums(cbind(matches$score_home,matches$score_away))
#Normalize data. Change the odd values to probabilities. We are taking
#the last odd into account here.
#### bet365 ####
wide_ou_odds=dcast(latest_ou_odds_bet365,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_bucket=c(5:15)/15
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="Bet365")
abline(coef=c(0,1))
#### 1xBet ####
wide_ou_odds=dcast(latest_ou_odds_1xBet,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="1xBet")
abline(coef=c(0,1))
### Betclic ####
wide_ou_odds=dcast(latest_ou_odds_Betclic,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="Betclic")
abline(coef=c(0,1))
### BetVictor ####
wide_ou_odds=dcast(latest_ou_odds_BetVictor,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="BetVictor")
abline(coef=c(0,1))
### Betway ####
wide_ou_odds=dcast(latest_ou_odds_Betway,matchId~oddtype,value.var='last_odd')
wide_ou_odds$result=rowSums(cbind(wide_ou_odds$over,wide_ou_odds$under))
wide_ou_odds$over_prob=wide_ou_odds$over/wide_ou_odds$result
wide_ou_odds$under_prob=wide_ou_odds$under/wide_ou_odds$result
ou_odds_results=merge(wide_ou_odds,matches[,list(matchId,sum_score)],by=c('matchId'),all.x=TRUE)
ou_odds_results[,score:=ifelse(sum_score>2.5,'over','under')]
ou_odds_results[,discrete_over:=cut(over_prob,ou_bucket)]
summary_ou_buckets_over=ou_odds_results[,list(overwins=sum(score=='over',na.rm=TRUE),.N),by=list(discrete_over)]#gerçekte over ile bitenler toplanır, value aralıklarına göre pivot alınır
summary_ou_buckets_over[,ratio_over:=overwins/N]
summary_ou_buckets_over=summary_ou_buckets_over[order(discrete_over)]
summary_over=ou_odds_results[,list(avg_over_prob=mean(over_prob,na.rm=TRUE),.N),by=list(discrete_over)]
scatterplot(summary_over$avg_over_prob,summary_ou_buckets_over$ratio_over,
xlab="Average probability of overs in a bin", ylab="Actual overs ratio in a bin",
main="Betway")
abline(coef=c(0,1))
#1-b - Selected bookmaker: Betway
annual=merge(wide_ou_odds,matches[,list(matchId,sum_score,date)],by=c('matchId'),all.x=TRUE)
annual[,score:=ifelse(sum_score>2.5,'over','under')]
annual[,timestamp:=as_datetime(date,tz='Turkey')]
annual[,discrete_over:=cut(over_prob,ou_bucket)]
annual=annual[sum_score<2.5,over_under:=0]
annual=annual[sum_score>2.5,over_under:=1]
annual_pivot=annual[,list(odd_avg=mean(over_prob,na.rm=T),real_avg=mean(over_under,na.rm = T),count=.N),by=list(year(timestamp),discrete_over)]
annual_pivot=annual_pivot[order(year)]
annual_pivot2=annual_pivot[discrete_over=='(0.4,0.45]']
x=annual_pivot2$year
y1=annual_pivot2$odd_avg
y2=annual_pivot2$real_avg
plot(x,y1,type="l",col="red",ylim=c(0.42,0.7))
par(new=TRUE)
plot(x,y2,type="l",col="green",ylim=c(0.42,0.7))
View(annual_pivot2)
View(annual_pivot)
View(annual)
View(annual_pivot)
annual_pivot2=annual_pivot[discrete_over=='(0.4,0.467]']
x=annual_pivot2$year
y1=annual_pivot2$odd_avg
y2=annual_pivot2$real_avg
plot(x,y1,type="l",col="red",ylim=c(0.42,0.7))
plot(x,y2,type="l",col="green",ylim=c(0.42,0.7))
plot(x,y1, type="l", col="green", lwd=5, xlab="Years", ylab="Odd-Actual Averages", xlim=c(2015,2019), ylim=c(0.42,0.7))
lines(x, y2, col="red", lwd=2)
title("Betway Odds Over the Years")
legend(2,1,c("Odds","Actual"), lwd=c(5,2), col=c("green","red"))
unlink('HW_1_v3_cache', recursive = TRUE)
